
&laquo;&nbsp;<a href="javascript:load_content('docs')">Back to Documentation</a>
<h1>Specfile</h1>
<p>
The Singularity specfile is designed around the notion of packaging, so some
packaging standards have been leveraged. The specfile tells Singularity what
components from the host operating system should be included and packaged into
the Singularity Application (SAPP) container. This format is also young and
more features will be included as they become needed. At present the specfile
is divided into two areas: tags (key-value pairs which are usually for header
information) and sections. Both are defined below:
<h2>Key/Value Tags</h2>
<p>
All Tags must be defined above any sections, so they are usually found at the
top of the specfile. They have the format "KEY: VALUE" (key name followed by a
colon, then a single space and a single line value string). Valid tag names are
defined below:
<ul>
<li>
<strong>Name:</strong>
Define the name of the SAPP package. If this is omitted then the name is
derived from the name of the specfile.
<br/>
<em>
note: this should not have spaces or other non-file name happy characters.
</em>
</li>
<li>
<strong>Maintainer:</strong>
The free form name and email address of the SAPP maintainer or developer that
created and maintains this package.
</li>
<li>
<strong>Exec:</strong>
The primary binary or script that will be exec'ed when this SAPP environment
is run.
<br/>
<em>
note: If this tag is omitted, you must define a %runscript section!
</em>
</li>
<li>
<strong>DebugOS:</strong>
This will cause various debug'ing utilities to be included into the SAPP
container (e.g. cat, ps, strace, etc..).
</li>
</ul>
</p>
<h2>Sections</h2>
<p>
Sections (unlike tags) are meant for multi-line information and are all prefixed
with a '%' (percent sign). The section will include all following lines until
either the end of the file or the next section. Supported section names are as
follows:
<ul>
<li>
<strong>%files</strong>
This should be a list of all files from the host operating system that should be
bundled into the SAPP environment. All of the programs, data, configurations, and
files that you need to run should be listed. One line per file (globs supported).
</li>
<li>
<strong>%runscript</strong>
The runscript is the driver which gets exec'ed when the SAPP bundle is run. Iff
you have defined an "Exec:" declaration above, then by default this written for
you. Using this feature, you can either rewrite the default behavior or if you
have chosen not to define "Exec:" then this section would be required. This
section will be executed as a shell script within the SAPP environment (container)
thus standard shell syntax is not only supported but required.
</li>
<li>
<strong>%test</strong>
Here you can run any tests to ensure that your envrionment is working properly
before it is built and packaged into a SAPP file. The format is standard shell
and any non zero exit is considered a failure and will thus halt the build.
</li>
<li>
<strong>%packages</strong>
You can also include the contents of an installed package (e.g. RPM and DEB).
This will not invoke the package dependency tree, but will rather be used as a
shortcut for identifying files to include.
<em>
note: Because this will install all files within the listed packages, you can
very quickly bloat your Singularity container! You have been warned!
</em>
</li>
<li>
<strong>%build</strong>
Here you can add a shell scriptlet which can be used to prepare components,
data, programs, etc. that will be part of your container. If the scriptlet
exits with an error condition (any exit code greater then 0/zero), then the
build will also error.
</li>
<li>
<strong>%install</strong>
This is a shell scriptlet similiar to %build which should be used to install into
the container. The temporary container location can be address via the envrionment
variable <em>$INSTALLROOT</em> so an install command should have the format:
<pre>
%install
mkdir -p $INSTALLROOT/bin
cp /bin/cat $INSTALLROOT/bin/cat
</pre>
If the scriptlet exits with an error condition (any exit code greater then
0/zero), then the build will also error.
</li>
</ul>
</p>
<h2>Examples</h2>
<p>
<h3>A minimal specfile illustrating how to package a system command</h3>
<p>
Because we are using the 'Exec' tag, Singularity will automatically exec the
container properly including pipes and pass all arguments to the program /bin/find
properly. You would run the resulting SAPP container in the same manner as you
would run the program being Exec'ed.
</p>
<pre>
Name: find
Exec: /bin/find
</pre>
<h3>How to package a work-flow</h3>
<p>
This example demonstrates how to do something specific within the SAPP container.
Here we will package up a simple data file example, and demonstrate how to use a
shell scriptlet to do something specific with the arguments provided.
</p>
<pre>
Name: services

%files
/bin/grep
/etc/services

%runscript
for i in $@; do
    grep "$i" /etc/services
done

%test
if grep -q "smtp" /etc/services; then
    exit 0
else
    exit 1
fi
</pre>
</p>
</p>

    